<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Recherche sanctifi√©e sur Dramaltech - Connect√© aux archives du savoir de Wikip√©dia et Llama AI"
        />
        <meta
            name="keywords"
            content="Dramaltech, recherche, Omnimessie, Mechanicus, Wikip√©dia, Llama AI, savoir, esprit-machine"
        />
        <meta name="author" content="Techno-Pr√™tre du Mechanicum" />
        <title>Dramaltech - Recherche B√©nie</title>
        <link rel="stylesheet" href="mechanichum.css" />
    </head>
    <body>
        <header class="header">
            <h1 class="title">üîé Recherche B√©nie par l'Omnimessie</h1>
            <p class="subtitle">
                Consultation des Cogitateurs de la Sainte Archive
            </p>
            <nav class="menu">
                <ul>
                    <li><a href="mechanichum.html">Accueil</a></li>
                    <li><a href="contactmagos.html">Contact Magos-Tech</a></li>
                    <li><a href="about.html">√Ä propos</a></li>
                </ul>
            </nav>
        </header>

        <section class="section search-container">
            <h2 class="section-title">
                üõ†Ô∏è Entrez votre requ√™te, Serviteur du Savoir
            </h2>
            <div class="search-bar">
                <input
                    type="text"
                    id="search-input"
                    class="search-box"
                    placeholder="Saisissez un terme..."
                />
                <button id="search-button" class="search-button">
                    ‚öôÔ∏è Lancer la Cogitation
                </button>
            </div>
        </section>

        <section id="search-results" class="section">
            <h2 class="section-title">üì° R√©sultats de la Cogitation</h2>
            <p class="section-content">
                Les donn√©es sanctifi√©es appara√Ætront ici.
            </p>
        </section>

        <footer class="footer">
            <p class="footer-text">
                &copy; 2025 Dramaltech. Que l'Esprit-Machine veille sur vous.
                ‚öôÔ∏èüîß
            </p>
        </footer>

        <script>
            const LLAMA_API_KEY = "30509b70-54bf-4101-bafe-8babfb709bd4";

            document
                .getElementById("search-button")
                .addEventListener("click", rechercherWikipedia);
            document
                .getElementById("search-input")
                .addEventListener("keypress", function (event) {
                    if (event.key === "Enter") {
                        rechercherWikipedia();
                    }
                });

            async function rechercherWikipedia() {
                let query = document
                    .getElementById("search-input")
                    .value.trim();
                if (!query) {
                    document.getElementById("search-results").innerHTML =
                        '<p class="feature-item">‚ö†Ô∏è Aucune donn√©e ne peut √™tre cogit√©e sans une entr√©e valide !</p>';
                    return;
                }

                query = encodeURIComponent(query);
                const endpoint = `https://fr.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts|info&exintro=true&explaintext=true&titles=${query}&redirects=1&inprop=url`;
                const resultsContainer =
                    document.getElementById("search-results");
                resultsContainer.innerHTML =
                    '<p class="loading">‚è≥ Consultations des archives sacr√©es...</p>';

                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    const pages = data.query.pages;
                    const pageId = Object.keys(pages)[0];
                    const page = pages[pageId];

                    if (pageId === "-1") {
                        return rechercherLlamaAI(query);
                    }

                    resultsContainer.innerHTML = `
                    <h2 class="section-title">üìú R√©sultats pour : ${page.title}</h2>
                    <p class="section-content">${page.extract || "Aucune description disponible."}</p>
                    <a href="${page.fullurl}" target="_blank" class="feature-item">üîó Acc√©der aux archives compl√®tes</a>
                `;
                } catch (error) {
                    resultsContainer.innerHTML =
                        '<p class="feature-item">üö® √âchec de la connexion aux archives sacr√©es.</p>';
                }
            }

            async function rechercherLlamaAI(query) {
                const resultsContainer =
                    document.getElementById("search-results");
                resultsContainer.innerHTML =
                    '<p class="loading">üîÑ Invocation de Llama AI...</p>';

                try {
                    const response = await fetch(
                        "https://api.llama.ai/v1/generate",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${LLAMA_API_KEY}`,
                            },
                            body: JSON.stringify({
                                model: "llama3.3-70b",
                                prompt: `Donne-moi un r√©sum√© sur ${query}.`,
                                max_tokens: 200,
                            }),
                        },
                    );

                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! Status: ${response.status}`,
                        );
                    }

                    const data = await response.json();
                    resultsContainer.innerHTML = `
                    <h2 class="section-title">üìú R√©sultats de Llama AI :</h2>
                    <p class="section-content">${data.text || "Aucune donn√©e disponible."}</p>
                `;
                } catch (error) {
                    resultsContainer.innerHTML = `<p class="feature-item">üö® √âchec de la communication avec Llama AI. D√©tails : ${error.message}</p>`;
                }
            }
        </script>
    </body>
</html>
