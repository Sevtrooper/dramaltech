<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Recherche sanctifiÃ©e sur Dramaltech - ConnectÃ© aux archives du savoir de WikipÃ©dia et Llama AI"
        />
        <meta
            name="keywords"
            content="Dramaltech, recherche, Omnimessie, Mechanicus, WikipÃ©dia, Llama AI, savoir, esprit-machine"
        />
        <meta name="author" content="Techno-PrÃªtre du Mechanicum" />
        <title>Dramaltech - Recherche BÃ©nie</title>
        <link rel="stylesheet" href="mechanichum.css" />
    </head>
    <body>
        <header class="header">
            <h1 class="title">ğŸ” Recherche BÃ©nie par l'Omnimessie</h1>
            <p class="subtitle">
                Consultation des Cogitateurs de la Sainte Archive
            </p>
            <nav class="menu">
                <ul>
                    <li><a href="mechanichum.html">Accueil</a></li>
                    <li><a href="contactmagos.html">Contact Magos-Tech</a></li>
                    <li><a href="prediction.html">Lecture de l'Avenir</a></li>
                    <li><a href="about.html">Ã€ propos</a></li>
                </ul>
            </nav>
        </header>

        <section class="section search-container">
            <h2 class="section-title">
                ğŸ› ï¸ Entrez votre requÃªte, Serviteur du Savoir
            </h2>
            <div class="search-bar">
                <input
                    type="text"
                    id="search-input"
                    class="search-box"
                    placeholder="Saisissez un terme..."
                />
                <button id="search-button" class="search-button">
                    âš™ï¸ Lancer la Cogitation
                </button>
            </div>
        </section>

        <section id="search-results" class="section">
            <h2 class="section-title">ğŸ“¡ RÃ©sultats de la Cogitation</h2>
            <p class="section-content">
                Les donnÃ©es sanctifiÃ©es apparaÃ®tront ici.
            </p>
        </section>

        <footer class="footer">
            <p class="footer-text">
                &copy; 2025 Dramaltech. Que l'Esprit-Machine veille sur vous.
                âš™ï¸ğŸ”§
            </p>
        </footer>

        <script>
            const LLAMA_API_KEY = "30509b70-54bf-4101-bafe-8babfb709bd4";

            document.getElementById("search-button").addEventListener("click", rechercherWikipedia);
			document.getElementById("search-input").addEventListener("keypress", function (event) {
			if (event.key === "Enter") {
				rechercherWikipedia();
			}
			});

	async function rechercherWikipedia() {
		let query = document.getElementById("search-input").value.trim();
		
		// ğŸ”¥ Filtrage des mots-clÃ©s hÃ©rÃ©tiques ğŸ”¥
		const motsInterdits = ["chaos", "tzeentch", "khorne", "nurgle", "slaanesh", "heretique", "xenos", "horus", "traitre"];
		if (motsInterdits.some(mot => query.toLowerCase().includes(mot))) {
			document.getElementById("search-results").innerHTML = `
				<p class="feature-item">ğŸš¨ ALERTE INQUISITORIALE ğŸš¨</p>
				<p class="section-content">Tentative d'accÃ¨s Ã  des archives corrompues dÃ©tectÃ©e ! <br>
				L'Inquisition a Ã©tÃ© notifiÃ©e. Restez oÃ¹ vous Ãªtes.</p>
				<p class="feature-item">ğŸ”¥ Exterminatus en cours... ğŸ”¥</p>
			`;
			console.warn("âš ï¸ HÃ‰RÃ‰SIE TECHNIQUE DÃ‰TECTÃ‰E âš ï¸ : Tentative de recherche interdite sur " + query);
			return;
		}

		if (!query) {
			document.getElementById("search-results").innerHTML =
				'<p class="feature-item">âš ï¸ Aucune donnÃ©e ne peut Ãªtre cogitÃ©e sans une entrÃ©e valide !</p>';
			return;
		}

		query = encodeURIComponent(query);
		const endpoint = `https://fr.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=extracts|info&exintro=true&explaintext=true&redirects=1&inprop=url&generator=search&gsrsearch=${query}&gsrlimit=1`;

		const resultsContainer = document.getElementById("search-results");
		resultsContainer.innerHTML = '<p class="loading">â³ Consultations des archives sacrÃ©es...</p>';

		try {
			const response = await fetch(endpoint);
			const data = await response.json();

			if (!data.query || !data.query.pages) {
				resultsContainer.innerHTML = '<p class="feature-item">âš ï¸ Aucune donnÃ©e retrouvÃ©e dans les cogitateurs archivaux.</p>';
				return;
			}

			// RÃ©cupÃ©rer la premiÃ¨re page valide
			const pages = Object.values(data.query.pages);
			const page = pages[0];

			resultsContainer.innerHTML = `
				<h2 class="section-title">ğŸ“œ RÃ©sultats pour : ${page.title}</h2>
				<p class="section-content">${page.extract || "Aucune description disponible."}</p>
				<a href="${page.fullurl}" target="_blank" class="feature-item">ğŸ”— AccÃ©der aux archives complÃ¨tes</a>
			`;
		} catch (error) {
			resultsContainer.innerHTML = '<p class="feature-item">ğŸš¨ Ã‰chec de la connexion aux archives sacrÃ©es.</p>';
		}
	}


            async function rechercherLlamaAI(query) {
                const resultsContainer =
                    document.getElementById("search-results");
                resultsContainer.innerHTML =
                    '<p class="loading">ğŸ”„ Invocation de Llama AI...</p>';

                try {
                    const response = await fetch(
                        "https://api.llama.ai/v1/generate",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${LLAMA_API_KEY}`,
                            },
                            body: JSON.stringify({
                                model: "llama3.3-70b",
                                prompt: `Donne-moi un rÃ©sumÃ© sur ${query}.`,
                                max_tokens: 200,
                            }),
                        },
                    );

                    if (!response.ok) {
                        throw new Error(
                            `HTTP error! Status: ${response.status}`,
                        );
                    }

                    const data = await response.json();
                    resultsContainer.innerHTML = `
                    <h2 class="section-title">ğŸ“œ RÃ©sultats de Llama AI :</h2>
                    <p class="section-content">${data.text || "Aucune donnÃ©e disponible."}</p>
                `;
                } catch (error) {
                    resultsContainer.innerHTML = `<p class="feature-item">ğŸš¨ Ã‰chec de la communication avec Llama AI. DÃ©tails : ${error.message}</p>`;
                }
            }
        </script>
    </body>
</html>
